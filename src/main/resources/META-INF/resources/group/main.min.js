(()=>{var i={},f=r=>{let e=r.split(" "),o=e,n=[],s=[],t={};for(let u=0;u<e.length;u++){let l=e[u];if(/@group|[+|-|=|:].*/.test(l)){n.push(l);let a=/([+|-|=|:])$/.test(l);(l.length===1||a)&&(n.push(e[u+1]),e=e.filter(g=>g!==e[u+1])),o=o.filter(g=>g!==l)}else s.push(l)}return t.groupData=n.join(""),t.finalContent=s.join(" "),t},d=(r,e,o)=>{let n=/^(.*?)$/.exec(r.groupData.substring(o.index+1));if(n)try{n=/^(.*?)[:|<br>]/.exec(r.groupData.substring(o.index+1)).pop()}catch{n=/^(.*?)$/.exec(r.groupData.substring(o.index+1)).pop()}let s=/:(.*?)$/.exec(r.groupData.substring(o.index+1));if(s&&(s=/:(.*?)$/.exec(r.groupData.substring(o.index+1)).pop()),/@group|[+]|-|=|:.*/.test(n+s)||!n||!n.length||n.trim()==="<br>")try{throw new Error("Invalid Group Command "+content)}catch(t){return console.error(t),e.status=-1,e.errorMessage=t.message,e}return e.groupName=n,e.memberName=s,e.groupMessage=r.finalContent,e.status=0,e.errorMessage=null,e.groupOwner=document.querySelector(".handle").innerHTML,e.ownerId=doDexMess.socket.url.split("id=")[1],e},b=(r,e)=>{let o;if(r.groupData&&r.groupData.startsWith("@group")){let n=["-","[+]","="],s,t;i={};for(let u=0;u<3;u++){let l=new RegExp(n[u]).exec(r.groupData);if(l)s=l[0];else continue;switch(s){case"+":o="/groups/addGroup",i=d(r,i,l),i.method="PUT",i.uri=o;break;case"-":o="/groups/removeGroup",i=d(r,i,l),i.method="DELETE",i.uri=o;break;case"=":i=d(r,i,l),i.method="POST",i.uri="/groups/getGroup/"+i.groupName;break;default:console.log("Error Command/groupName******:",s,i.groupName);break}}if(!s&&!i.groupName)try{throw new Error("Invalid Group Command "+e)}catch(u){return console.error(u),i.status=-1,i.errorMessage=u.message,i}return i}};var h=!1,v=()=>{let r;try{r=document.querySelectorAll(".dial");for(let e of r)window.observer||e.addEventListener("dblclick",T)}catch(e){console.error("Error: "+e.message)}},p=async()=>{let r=document.querySelector("#dodexComm").querySelector(".user-msg"),e=document.querySelector("#dodexComm").querySelector("select");var o=r.innerHTML.replace(/&nbsp;/g,"").trim();let n=o.toLowerCase().includes("@group");if(!(o.length<2||o==="<br>"))if(o.length>1&&!n){let s=w(o);window.doDexMess.socket.send(s),r.innerHTML=""}else{let s=f(o),t=b(s,o);if(!t){chatbox.innerHTML+="Invalid input: "+o+"<br>",r.innerHTML="";return}if(t.status===-1){chatbox.innerHTML+=t.errorMessage+"<br>",r.innerHTML="";return}let u=w(t.groupMessage);t.groupMessage=u;let l="Deleting 'group/members(s)'. Are you sure?";if(t.method==="DELETE"&&(t.groupMessage.length===0||t.groupMessage===";users!![]")&&confirm(l)===!1)return;h&&console.warn("Post Message:",M+"//"+y+t.uri,t);let m=await L(M+"//"+y+t.uri,t,t.method);r.innerHTML="";let c=await m.json();if(chatbox.innerHTML+=typeof c=="number"?"Failed with "+c:`${m.statusText.toLowerCase()}<br>`,chatbox.innerHTML+=c.errorMessage!==null?c.errorMessage+"<br>":"",h&&console.warn("Return data",c),t.groupMessage!==""&&c.status===0&&t.groupMessage.trim().indexOf(";users!!")>5&&(r.innerHTML=t.groupMessage,p()),c.members!==null&&typeof c.members<"u"){typeof c.members=="string"&&(c.members=JSON.parse(c.members));for(let a=e.length-1;a>-1;a--)e.removeChild(e[a]);for(let a=0;a<c.members.length;a++){let g=document.createElement("OPTION");g.text=c.members[a].name,g.value=c.members[a].name,e.add(g)}}}},w=r=>{if(r.indexOf(";users!!")===-1){let e=document.querySelector("#dodexComm"),o=e.querySelector("select");if(e&&o){let n=S(o);e.querySelector('a[name="private"]').innerHTML==="Broadcast"&&(r+=";users!!"+JSON.stringify(n))}}return r},S=r=>{let e=[],o;var n=r.options.length;for(let s=0;s<n;s++)o=r.options[s],o.selected&&e.push(o.value);return e},T=()=>{let r=document.querySelector("#usermsg");if(!r||window.observer)return;let e={childList:!0,subtree:!0,attributes:!1},o=(n,s)=>{for(let t of n)if(t&&t.target&&t.target.id==="usermsg"){document.querySelector(".input-send").onclick=p,window.doDexMess.socket.onopen=()=>{document.querySelector(".input-send").onclick=p};return}};window.observer||(window.observer=new MutationObserver(o),window.observer.observe(r,e))},L=async(r="",e={},o="GET")=>await fetch(r,{method:o,mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:o==="GET"?null:JSON.stringify(e)}).catch(s=>{console.error(s.message)}),M=window.location.protocol,x=window.location.port=="8890"?"8880":window.location.port=="8888"?"8087":window.location.port.toString(),y=window.location.hostname+(x.length>0?":"+x:"");window.groupListener=v;})();
