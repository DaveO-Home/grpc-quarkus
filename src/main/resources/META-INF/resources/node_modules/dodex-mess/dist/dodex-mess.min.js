!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).messBundle=t()}(this,(function(){"use strict";const e=[128512,128516,127818,127812,127871,127843,127856,127829,127828,127839,128704,128142,128506,9200,128377,128218,128049,128042,128057,128036,128512,128515,128516,128513,128518,128517,129315,128514,128578,128579,128521,128522,128519,129312,128526,129299,129488,127808,127958,127773,128511,9749,9875,9918,9969,9971,9973,127752,127774,127797,127921,127922,128051,128692];let t,n,o,r,c=Math.floor(53*Math.random())+0,l=0,d=null,s=null,a=[];const i="Broadcast",u="Private Message",m=()=>{if(d)return;c=Math.floor(53*Math.random())+0,h.server=o.server;let t=o.handle;o.handle.includes("-:-")||(t=o.handle+String.fromCodePoint(e[c])),o.mess.getUUID(t).then((function(e){if("string"==typeof e)console.error(e);else{const t=window.btoa(e.comm.id);s=e.comm.id,o.mess.webSocket({handle:e.comm.handle,id:t}),document.querySelector(".handle").innerHTML=d,document.querySelector(".dodex-comm").classList.toggle("pop-show")}}))},p=()=>{h.socket.close(1e3),document.querySelector(".handle").innerHTML="";document.querySelector(".chat-box").innerHTML="",l=0,d=null,s=null,a=[];const e=document.querySelector("#dodexComm");e.querySelector('a[name="private"]').innerHTML=u,e.classList.toggle("pop-show");const t=document.body,n=document.documentElement;t.scrollTop=0,n.scrollTop=0},h={popup(e,c,l){n=e,r=l,o=c,void 0===t&&(t=function(){let e=document.querySelector("body"),t=document.createElement("div");S(t,"id","dodexComm"),S(t,"class","dodex-comm"),e.insertBefore(t,document.querySelector(".top--dodex"));let c=t,l=document.createElement("div");S(l,"id","menu"),S(l,"class","menu");let m=document.createElement("p");S(m,"class","welcome"),m.innerHTML='<h1 style="font-size: 14px;">\n    <svg height="18" width="17" style="font-family: \'Open Sans\', sans-serif;">\n    <text x="3" y="18" fill="#059">O</text><text x="0" y="15" fill="#059">D</text></svg> doDex Messaging <span class="handle"></span></h1>',l.appendChild(m),m=document.createElement("p"),function(e){let t=document.createElement("img");S(t,"src","../images/more_horiz.png"),S(t,"class","image-horiz");let c=document.createElement("div");S(c,"class","mess-dropdown"),c.appendChild(t);let l=document.createElement("div");S(l,"id","commDropdown"),S(l,"class","dropdown-content");let m=document.createElement("a");S(m,"href","#"),m.innerHTML="Clear Log",l.appendChild(m),m=document.createElement("a"),S(m,"href","#"),m.innerHTML="Change Handle",l.appendChild(m),m=document.createElement("a"),S(m,"href","#"),S(m,"name","private"),m.innerHTML="Private Message",l.appendChild(m),m=document.createElement("a"),S(m,"href","#"),S(m,"name","credentials"),m.innerHTML="Grab Credentials",l.appendChild(m),m=document.createElement("a"),S(m,"href","#"),m.innerHTML="Exit",l.appendChild(m),c.appendChild(l),e.appendChild(c),t.onclick=()=>{document.querySelector("#commDropdown").classList.toggle("show")},window.onclick=e=>{if(!e.target.matches(".image-horiz")){var t,n=document.querySelectorAll(".dropdown-content");for(t=0;t<n.length;t++){var o=n[t];o.classList.contains("show")&&o.classList.remove("show")}}};const h=l.querySelectorAll("a");for(let e in h)switch(h[e].innerHTML){case"Clear Log":h[e].onclick=e=>(document.querySelector("#chatbox").innerHTML="",e.preventDefault(),!1);break;case"Change Handle":h[e].onclick=e=>{indexedDB.deleteDatabase("dodex-comm").onsuccess=()=>{document.querySelector(".user-msg").textContent=";removeuser!!",f(),p(),o.mess.popup(n,o,r)}};break;case"Private Message":case"Broadcast":h[e].onclick=e=>{const t=document.querySelector("#dodexComm").querySelector(".private");return null!==t&&(t.classList.toggle("show"),e.target.innerHTML===u?e.target.innerHTML=i:(e.target.innerHTML=u,a=[],v(document.querySelector("#dodexComm").querySelector("select")))),e.preventDefault(),!1};break;case"Grab Credentials":h[e].onclick=e=>{const t=document.createElement("input");t.setAttribute("type","text"),e.target.appendChild(t),t.value=d+"-:-"+s,t.select(),t.setSelectionRange(0,99999),navigator.clipboard.writeText(t.value).then((()=>{e.target.removeChild(t)}))};break;case"Exit":h[e].onclick=p}}(m),l.appendChild(m),c.appendChild(l),t=document.createElement("div"),S(t,"id","chatbox"),S(t,"class","chat-box"),c.appendChild(t);let h=document.createElement("a");S(h,"id","dodexComm"),c.appendChild(h);let g=document.createElement("input");return S(g,"id","inputsend"),S(g,"value","Send"),S(g,"class","input-send"),S(g,"type","button"),c.appendChild(g),t=document.createElement("div"),S(t,"contenteditable","true"),S(t,"id","usermsg"),S(t,"class","user-msg"),c.appendChild(t),t.addEventListener("keydown",(function(e){return!("s"==String.fromCharCode(e.button).toLowerCase()&&e.ctrlKey||19==e.key)||(f(),e.preventDefault(),!1)})),h}(),t.onclick=m),new Promise((function(e){var t=indexedDB.open("dodex-comm");t.onupgradeneeded=function(){t.result.createObjectStore("comm",{keyPath:"idx",autoIncrement:!1})},t.onsuccess=t=>{g("comm",t.target.result).then((function(n){t.target.result.close(),e(n)}))},t.onerror=e=>{console.warn(e)}})).then((function(e){"string"==typeof e?(!function(){let e=document.querySelector("body"),t=document.createElement("div");S(t,"id","commHandle"),S(t,"class","comm-handle"),e.insertBefore(t,document.querySelector(".top--dodex"));let n=t,o=document.createElement("div");S(o,"id","menuHandle"),S(o,"class","menu");let r=document.createElement("p");S(r,"class","welcome"),r.innerHTML='<h1 class="handle" style="font-size: 14px;">\n            Enter your chat handle</h1>',o.appendChild(r),r=document.createElement("p"),S(r,"class","close-handle");let c=document.createElement("a");S(c,"id","closeHandle"),c.innerHTML="Exit",c.onclick=()=>{document.querySelector("#commHandle").classList.toggle("pop-show")},r.appendChild(c),o.appendChild(r),n.appendChild(o),c=document.createElement("a"),S(c,"id","handleComm"),n.appendChild(c);let l=document.createElement("br");n.appendChild(l);let d=document.createElement("input");S(d,"id","inputHandle"),S(d,"value","Save"),S(d,"class","input-save"),S(d,"type","button"),d.onclick=y,n.appendChild(d),t=document.createElement("input"),S(t,"id","handlemsg"),S(t,"type","text"),S(t,"class","handle-msg"),n.appendChild(t),t.addEventListener("keydown",(function(e){return!("s"==String.fromCharCode(e.key).toLowerCase()&&e.ctrlKey||19==e.key)||(y(),e.preventDefault(),!1)}))}(),document.querySelector("#commHandle").classList.toggle("pop-show")):t.click()}))},socket:null,server:"localhost:3087",getUUID:e=>function(e){return new Promise((function(t){let n,o,r,c=indexedDB.open("dodex-comm");c.onupgradeneeded=function(){n=c.result,r=n.createObjectStore("comm",{keyPath:"idx",autoIncrement:!1})},c.onsuccess=function(c){n=c.target.result,g("comm",n).then((function(c){if("string"!=typeof c)return n.close(),void t(c);o=n.transaction("comm","readwrite"),r=o.objectStore("comm");let l=function(e,t,n){let o=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);const r=(e=e||{}).random||(e.rng||x)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t)for(var c=0;c<16;++c)t[o+c]=r[c];for(let e=0;e<256;++e)w[e]=(e+256).toString(16).substring(1);return t||function(e,t){let n=t||0,o=w;return[o[e[n++]],o[e[n++]],o[e[n++]],o[e[n++]],"-",o[e[n++]],o[e[n++]],"-",o[e[n++]],o[e[n++]],"-",o[e[n++]],o[e[n++]],"-",o[e[n++]],o[e[n++]],o[e[n++]],o[e[n++]],o[e[n++]],o[e[n++]]].join("")}(r)}();const d={},s=e.split("-:-");2===s.length&&(e=s[0],l=s[1]),d.comm={handle:e,id:l},d.idx="comm";r.put(d).onsuccess=function(){g("comm",n).then((function(e){n.close(),t(e)}))}}))},c.onerror=function(e){console.error("Error",e.target)}}))}(e),webSocket(e){if(!(e&&e.handle&&e.id))throw new Error("Must supply 'handle' and 'id' for WebSocket");{d=e.handle;let t="ws://";"https:"===window.location.protocol&&(t="wss://"),this.socket=new WebSocket(t+this.server+"/dodex?handle="+d+"&id="+encodeURIComponent(e.id))}return this.socket.onerror=e=>{console.error(e)},this.socket.onopen=()=>{document.querySelector(".input-send").onclick=f},this.socket.onmessage=e=>{const t=new Date,n=C(t.getHours()),o=C(t.getMinutes()),r=document.querySelector(".chat-box"),c=function(e){const t=e.split("connected:");if(t.length<2)return e;!function(e){const t=document.querySelector("#dodexComm");null!==t.querySelector(".private")&&t.removeChild(t.querySelector(".private"));const n=document.createElement("select");S(n,"class","private"),S(n,"multiple","true");let o=e.length;for(let r=0;r<o;r++){const o=document.createElement("option");S(o,"value",e[r].name),o.innerHTML=e[r].name,n.appendChild(o),t.appendChild(n)}n.addEventListener("change",(e=>{a=function(e){const t=[];let n;var o=e.options.length;for(let r=0;r<o;r++)n=e.options[r],n.selected&&t.push(n.value);return t}(e.target)}))}(JSON.parse(t[1]));return"connected"}(e.data);r.innerHTML+=`${n}:${o} ${c}<br>`,(r.scrollTop>l||0===l)&&(l=r.scrollTop,r.scrollTop=r.scrollHeight)},this.socket.onclose=e=>{d=null,1e3!==e.code&&console.warn("Closed",e.code)},this.socket}};function f(){let e=document.querySelector("#dodexComm").querySelector(".user-msg");var t=e.innerHTML;if(t.length>1){const n=function(e){if(document.querySelector("#dodexComm").querySelector('a[name="private"]').innerHTML===i)return e+";users!!"+JSON.stringify(a);return e}(t);h.socket.send(n),e.innerHTML=""}}function g(e,t){return new Promise((function(n,o){0===t.objectStoreNames.length&&n(`Store ${e} not found`);var r=t.transaction(["comm"],"readonly").objectStore("comm").get(e);r.onsuccess=function(){var t=r.result;n(void 0!==t?t:`Record ${e} not found`)},r.onerror=function(t){o(`Record ${e} not found : ${t}`)}}))}function y(){const e=document.querySelector(".handle-msg");o.handle=e.value,e.value.length<4||(e.value="",document.querySelector("#commHandle").classList.toggle("pop-show"),t.click())}function v(e){var t=e.options.length;for(let n=0;n<t;n++)e.options[n].selected=!1}function S(e,t,n){const o=document.createAttribute(t);o.value=n,e.setAttributeNode(o)}function C(e){return e<10&&(e="0"+e),e}window.doDexMess=h;const w=[];function x(){return Math.random().toString().substring(2,18).toString(10).split("").map((e=>parseInt(e)))}return h}));