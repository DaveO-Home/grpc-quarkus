!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).inputBundle=t()}(this,(function(){"use strict";let e,t,n,o;const r=function(e){var r=e.transaction("cards","readonly").objectStore("cards").getAll();r.onsuccess=function(){const c=r.result.sort((function(e,t){return Number(e.idx.replace("card",""))>Number(t.idx.replace("card",""))?1:-1}));for(let e=0;e<c.length;e++){const n=Number(c[e].idx.replace("card",""));!function(e,n){const r={cards:{}};r.cards=e,"append"===e.type&&n<o.length||n<=27||n<o.length?("replace"===e.type&&(document.querySelector(".front"+n).innerHTML="",document.querySelector(".back"+n).innerHTML=""),i(r,e.idx,n,o)):t.addCard(r)}(c[e],n)}n.linkClickHandler(),e.close()}};function c(c,p,f){function m(e,t){let n;const o=document.querySelectorAll("[name=type]"),c=(void 0!==t?t:e.target.files)[0],i=c.type.match("javascript$"),u=c.type.match("json$"),p=new FileReader;for(var f in o)if(o[f].checked){n=o[f].value;break}u||i?(p.onload=e=>{let t;const o=e.target.result;if(i&&o.match("^[ |\t|\n]*return.*{")?t=new Function('"use strict"; '+o)():u&&(t=JSON.parse(o)),void 0===t)throw"Content is not a valid Object";"edit"===n?(t=function(e){const t=document.getElementById("jsoneditor");let n={};t&&(t.style["z-index"]=-1,n={name:"dodex",mode:"code",modes:["code","form","text","view","preview","tree"],onError:function(e){alert(e.toString())},onModeChange:function(e){let t=document.querySelector("table.jsoneditor-tree");if(t)t.style.backgroundColor="#fcfee6";else if("preview"===e){document.querySelector("pre.jsoneditor-preview").style.backgroundColor="#fcfee6"}}});let o=null;window.JSONEditor&&(window.jsonEditor||(o=new window.JSONEditor(t,n),window.jsonEditor=o),window.jsonEditor.set(e),window.jsonEditor.refresh())}(t),document.querySelector("#savefile").setAttribute("style","opacity:1; margin-left: 5px;"),document.querySelector("#jsoneditor").style["z-index"]=1008):function(e,t){return new Promise((function(n,o){var r,c,i,u,p=indexedDB.open("dodex",2),f=!1;p.onupgradeneeded=function(){r=p.result,f=!0,i=r.createObjectStore("cards",{keyPath:"idx",autoIncrement:!1})},p.onsuccess=function(o){r=o.target.result;for(let e=52;e>0;e--)if(t.cards["card"+e]){u=e;break}if("replace"===e||f){c=r.transaction("cards","readwrite"),i=c.objectStore("cards");for(let o in t.cards){const c={};if(t.cards[o].front){let e=t.cards[o].front.content,n=s(e);t.cards[o].front.content=""===n?e:n}if(t.cards[o].back){let e=t.cards[o].back.content,n=s(e);t.cards[o].back.content=""===n?e:n}c[o]=t.cards[o],c.idx=o,c.type=e;i.put(c).onsuccess=function(e){0===l&&(d=e.target.result,l=1),a=e.target.result,document.querySelector("#results").innerHTML=`Processed Cards: ${d} ~ ${a}`,"card"+u==o&&n(r)}}}else if("append"===e)for(let e in t.cards)p(e,a,n);function p(e,n,o){return function(e){return new Promise((function(t,n){var o,r,c=indexedDB.open("dodex",2);c.onsuccess=function(d){o=c.result,r=o.transaction(["cards"],"readonly");var a=r.objectStore("cards").get(e);a.onsuccess=function(){var o=a.result;void 0!==o?t(o):n(`Record ${e} not found`)}},c.onerror=function(e){n(e)}}))}(e).then((function(a){if(c=r.transaction("cards","readwrite"),i=c.objectStore("cards"),t.cards[e].front){let n=t.cards[e].front.content,o=s(n);a[e].front.content+=""===o?n:o}if(t.cards[e].back){let n=t.cards[e].back.content,o=s(n);a[e].back.content+=""===o?n:o}t.cards[e].tab&&(a[e].tab=t.cards[e].tab);i.put(a).onsuccess=function(t){0===l&&(d=t.target.result,l=1),n=t.target.result,document.querySelector("#results").innerHTML=`Processed Cards: ${d} ~ ${n}`,"card"+u==e&&o(r)}}))}},p.onerror=function(e){console.error("Error",e.target)}}))}(n,t).then(r)},p.readAsText(c,"UTF8")):console.warn("Content File must be js or json")}if(t=c,o=f,n=p,void 0===e&&(e=function(e){let t=document.querySelector("body"),n=document.createElement("div"),r=document.createElement("div");u(n,"id","dodexInput"),u(r,"id","results"),u(n,"class","content-input"),t.insertBefore(n,document.querySelector(".top--dodex"));let c=n;n=document.createElement("div");let d=document.createElement("a");u(d,"title","Close"),u(d,"class","close"),d.innerHTML="X",d.onclick=function(){var e=document.body,t=document.documentElement;e.scrollTop=0,t.scrollTop=0,function(e){try{e.value=null}catch(e){}e.value&&e.parentNode.replaceChild(e.cloneNode(!0),e)}(document.querySelector("#files")),document.querySelector("#dodexInput").style.opacity=0,setTimeout((()=>{document.querySelector("#dodexInput").style.display="none"}),500),window.jsonEditor&&(window.jsonEditor.destroy(),window.jsonEditor=null,document.querySelector("#jsoneditor").style["z-index"]=-1),document.querySelector("#savefile")&&(document.querySelector("#savefile").style.opacity=0)};let a=document.createElement("h5");a.innerHTML="Dodex Private Content Input",u(n,"class","input"),n.appendChild(d),n.appendChild(a);let l=document.createElement("p");const s=document.createElement("p"),p=document.createElement("br");d=document.createElement("a"),n.appendChild(d);const f=document.createElement("label");u(f,"for","files"),n.appendChild(f),f.innerHTML="Click to Select or Drag & Drop a file on Button",n.appendChild(l);const m=document.createElement("input");if(u(m,"id","files"),u(m,"type","file"),u(m,"name","files[]"),u(m,"size","1"),n.appendChild(m),n.appendChild(s),"full"===e.private||"partial"===e.private){let t=document.createElement("div");if(!0===e.replace){var y=document.createElement("label"),b=document.createTextNode("Replace"),w=document.createElement("input");w.type="radio",w.name="type",w.value="replace",w.checked=!0,y.appendChild(w),y.appendChild(b),t.appendChild(y)}var h=document.createElement("label"),v=document.createTextNode("Append"),E=document.createElement("input");if(E.type="radio",E.name="type",E.value="append",u(E,"style","margin-left: 5px;"),!1===e.replace&&(E.checked=!0),h.appendChild(E),h.appendChild(v),t.appendChild(h),window.JSONEditor){let e=document.createElement("label"),n=document.createTextNode("Edit"),o=document.createElement("input");o.type="radio",o.name="type",o.value="edit",u(o,"style","margin-left: 5px;"),e.appendChild(o),e.appendChild(n),t.appendChild(e);let r=document.createElement("label"),c=document.createElement("input");c.type="button",c.name="button1",c.value="Save",c.id="savefile",u(c,"style","opacity:0;"),c.addEventListener("click",(e=>{let t=document.createElement("a");t.href="data:application/octet-stream,"+encodeURIComponent(window.jsonEditor.getText()),t.download=document.querySelector("#files").value,t.click(),window.jsonEditor.refresh()}),!1),r.appendChild(c),t.appendChild(r)}let r=document.createElement("label"),c=document.createElement("input");u(c,"style","margin-left: 5px;"),c.type="button",c.name="button2",c.value="Remove Private Data",c.id="removedb",c.addEventListener("click",(e=>{!function(e){if(confirm("Are you sure?")){var t=indexedDB.deleteDatabase(e);t.onsuccess=function(){if(o)for(let e in o){const t=Number(e)+1;try{o[e].querySelector(".front"+t).innerHTML="",o[e].querySelector(".back"+t).innerHTML="",window.dodexContent&&window.dodexContent.cards&&i(window.dodexContent,"card"+t,t,o)}catch(e){console.error(e)}}console.warn("Removal accomplished")},t.onerror=function(e){console.error("Removal failed-",e)},t.onblocked=function(e){console.error("Removal blocked-",e)}}}("dodex")}),!1),r.appendChild(c),t.appendChild(r),n.appendChild(t)}return n.appendChild(p),n.appendChild(r),l=document.createElement("p"),n.appendChild(l),c.appendChild(n),d}(n),document.querySelector("#files").addEventListener("change",m,!1)),!(window.File&&window.FileReader&&window.FileList))throw"The File APIs are not fully supported in this browser.";e.click(),void 0!==window.__karma__&&(window.handleFileSelect=m)}let d,a,l=0;function i(e,t,n,o){const r=o[n-1].querySelector(".front"+n),c=o[n-1].querySelector(".back"+n);e.cards&&e.cards[t]&&(e.cards[t].front&&e.cards[t].front.content&&e.cards[t].front.content.length>0&&(r.insertAdjacentHTML("beforeend",e.cards[t].front.content),r.classList.add("green-tab")),e.cards[t].back&&e.cards[t].back.content&&e.cards[t].back.content.length>0&&c.insertAdjacentHTML("beforeend",e.cards[t].back.content))}function s(e){let t="";if(e.constructor===Array)for(let n in e)t+=e[n]+" ";return t}function u(e,t,n){const o=document.createAttribute(t);o.value=n,e.setAttributeNode(o)}return window.doDexInput=c,c}));